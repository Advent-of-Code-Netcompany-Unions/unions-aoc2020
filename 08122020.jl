# input = "nop +0\nacc +1\njmp +4\nacc +3\njmp -3\nacc -99\nacc +1\njmp -4\nacc +6"
input = "acc +13\nacc -6\nacc -8\njmp +140\nacc +44\nacc +21\nnop +23\njmp +455\nacc -1\njmp +143\nacc +9\nacc +19\njmp +507\nnop +513\nacc +38\nnop +444\njmp +560\nnop +19\nacc +9\nacc +19\njmp +33\nacc +11\nacc -11\nacc +10\njmp +486\nnop -12\nacc +38\nacc +5\njmp +394\nacc +23\njmp +236\nacc -9\nacc -10\nacc +32\nnop +45\njmp +562\njmp +423\nacc +3\nnop +340\njmp +217\nacc -14\nacc -6\njmp +397\nacc +17\nnop +165\nacc +41\nacc -9\njmp +554\nnop +7\nacc +0\njmp +235\nacc +32\njmp +486\njmp +280\njmp +408\njmp +73\njmp +482\nacc -17\nacc +24\njmp +377\njmp +379\nacc +13\njmp +277\nnop +232\nacc +2\nacc +33\njmp +247\nacc +48\nacc +22\njmp +105\njmp +269\njmp +326\njmp +516\nacc +32\nnop +147\njmp -27\njmp +1\nacc -8\njmp +376\nacc -13\nacc +0\nacc +43\nnop +380\njmp +230\nacc +34\njmp +130\nacc +18\nacc +0\njmp +402\nacc +31\nacc -1\nacc -5\njmp +134\njmp +334\nacc +35\nacc +0\nacc +5\nacc -10\njmp -85\nacc +5\nnop +444\nacc +10\njmp -9\nacc +46\nacc -12\nnop +98\nacc +29\njmp +119\nacc +8\nacc +21\njmp +422\nacc +19\njmp +78\nacc +42\nacc +18\nnop +344\nnop +353\njmp +26\nacc -16\nacc +20\njmp +370\nacc -5\nacc +29\njmp +465\nnop +176\nacc -13\nacc -16\njmp +300\nacc +12\nacc +43\nacc -1\njmp +215\nnop +214\nacc +13\njmp +141\nacc -3\nacc +42\nacc +5\njmp +49\nacc +7\nacc +7\nnop +2\njmp +5\nnop +123\nnop +112\njmp +45\njmp +276\nacc +4\nacc +5\nacc +13\njmp -97\njmp +311\nnop +347\nacc +6\njmp +1\njmp +162\nacc +36\nacc -6\njmp +386\nacc -10\nacc -8\njmp +163\nacc +32\nacc +13\njmp +1\njmp +361\nacc +43\nacc +6\nacc +31\njmp +52\nacc +23\nacc +34\nnop +186\njmp +268\nnop -103\nacc -17\njmp +242\nacc +30\nacc -4\njmp -32\nacc +27\nacc -17\njmp -142\nacc +30\nacc +17\njmp +1\njmp +415\njmp -132\nacc +15\njmp +176\nacc +15\nacc +12\nnop +382\njmp +237\njmp +32\nacc -8\nacc +40\nacc +28\njmp +1\njmp -186\nacc +9\nacc +49\njmp -55\nacc -16\nacc -7\nnop +240\nacc +29\njmp +255\njmp +182\nacc -16\nacc +9\njmp -31\nacc -13\nacc +29\njmp +387\nacc -13\nnop -180\nacc -11\njmp +77\nacc +16\njmp +368\njmp +224\nacc +32\nnop -187\nacc +48\njmp +307\nacc +11\nacc +38\nnop +47\njmp -94\njmp +1\nnop -170\nacc +31\njmp -180\nacc +30\nacc +1\njmp +1\nnop -63\njmp -12\nacc -4\nacc -12\nacc +15\nnop -68\njmp +13\nacc +24\nnop -50\nacc +31\nacc -2\njmp +333\nacc +39\nnop -179\njmp +158\nacc +24\njmp +169\nacc -3\njmp -207\nacc -13\njmp -54\nacc +31\njmp -93\nacc -4\nacc +40\njmp -96\nacc -15\nacc +31\njmp +68\nacc +38\nacc +7\nacc +12\njmp -9\nacc +49\nacc +33\nacc +27\nacc +36\njmp +50\njmp +208\njmp +1\nacc +42\nacc +34\njmp -151\nacc +17\njmp -195\nacc +37\nacc +34\njmp +62\njmp +1\nacc +9\nacc +3\nacc -2\njmp +266\nnop +254\nnop -170\nnop -133\nacc +40\njmp +225\nacc +38\nacc +33\nacc +39\njmp +262\njmp -278\nacc -17\nacc +16\nnop +128\njmp -116\nacc +13\nacc +49\nacc +36\nacc +33\njmp -215\nnop -301\njmp -197\nacc +50\njmp -37\nacc +42\nnop -253\njmp +159\njmp -142\nacc +14\njmp -123\nacc -7\nacc -13\nacc +33\nacc +42\njmp +232\nacc +2\nacc +26\nacc +3\njmp -112\nacc +29\nacc -12\nnop -263\nnop +114\njmp +7\njmp +157\nacc -7\nacc +11\nnop +245\nacc -2\njmp -225\nnop +120\njmp -114\nacc -5\nacc +22\nnop -122\nacc -11\njmp -70\nacc +1\nacc +24\nacc +23\nacc +37\njmp +188\nacc +0\nacc -10\njmp +1\njmp -283\njmp -80\nacc +4\njmp -183\nacc -16\nnop -306\njmp -213\nacc +10\nacc -2\nnop -17\njmp +146\nacc -8\nacc +5\nacc +19\nacc +37\njmp -261\nacc +28\nacc +49\njmp +111\nacc +37\nacc +44\nacc +20\njmp -11\njmp -53\nacc +25\njmp -343\nacc +7\nacc +46\njmp -187\nacc +20\nacc +50\nacc -8\njmp -365\nnop -9\nacc -18\njmp -43\nnop +165\nnop +78\nacc +33\nacc +19\njmp -321\nacc +46\njmp -275\nnop -88\nacc +4\nacc +33\nacc +47\njmp -18\njmp +166\njmp +1\nacc -4\nacc -9\nacc -2\njmp -173\njmp +54\nacc -3\nacc +2\nnop +16\nacc -13\njmp +184\nacc +26\nnop -322\nacc -12\njmp -362\njmp -118\nacc +7\nacc +33\njmp +153\njmp -13\nacc +19\njmp +1\nacc +23\njmp -373\nacc +12\njmp -184\njmp -185\njmp -57\nacc +48\nacc +8\nnop +71\nacc +26\njmp -96\njmp -227\nacc -10\njmp -381\njmp +75\njmp +74\njmp -320\nacc +0\nnop +101\njmp -98\nacc +33\nacc -4\njmp +1\nacc -9\njmp -197\nacc +36\nacc +15\nacc +24\njmp -400\nacc +18\njmp -77\nacc +25\nacc +1\njmp -112\nnop -150\njmp -381\njmp -152\nacc +38\nacc +50\nacc +43\njmp +103\nnop -4\nacc -6\njmp -309\nacc +34\nacc +2\nacc -15\njmp -411\njmp -70\nacc +39\nacc -3\nacc +6\nacc +22\njmp -123\njmp -89\nacc +11\njmp +70\njmp -339\nacc -4\njmp -325\nacc +44\nacc +8\nacc +15\nacc +29\njmp +87\njmp -411\nacc +30\njmp +12\nacc -14\njmp -14\nacc -17\njmp +1\nacc -12\njmp -441\njmp +1\nacc +0\nacc -12\njmp +108\njmp -277\njmp +103\nacc +12\nnop -427\nacc +10\nacc -16\njmp -322\nacc +1\njmp -412\nacc +37\njmp -130\nnop -474\njmp +86\nacc +5\nacc -12\njmp -461\nacc -18\nacc -12\nacc +30\nnop -356\njmp -30\nnop -207\njmp -128\nnop -168\nacc -4\njmp -98\nacc +32\nnop -264\njmp -5\nnop -337\nacc -10\nnop -195\nnop +62\njmp -37\njmp -489\njmp -148\nacc +50\nacc +33\nacc +8\nacc +49\njmp -353\nacc +1\nnop -13\nacc +27\njmp -492\njmp +1\nacc +43\njmp -46\nacc -16\njmp -149\nacc +28\njmp -525\nacc +48\njmp -30\nacc -5\nacc +21\njmp -15\njmp +1\nacc +17\nacc +42\nacc +36\njmp -343\nacc -7\nacc +3\njmp -346\nacc +44\nacc +18\nacc -10\nnop -262\njmp -338\njmp -111\njmp -105\njmp -319\nacc -11\njmp -297\nacc +1\nacc -3\njmp -271\nacc +15\nacc +6\nacc +24\njmp -80\nnop -477\nacc +39\njmp -49\nnop -62\nacc +23\nacc +15\njmp -47\nacc +16\nacc +5\nacc +11\nacc +42\njmp -430\nacc +14\nacc -16\njmp -80\njmp -571\nacc +46\nacc +31\njmp +1\nacc +31\njmp +13\njmp -5\njmp -599\nacc +41\njmp -105\njmp +1\njmp +1\nnop -360\njmp -542\nacc -5\nacc +20\nnop -595\njmp -124\nacc +14\nacc +40\nacc +14\nacc +34\njmp +1"

jump = "jmp"
accumulate = "acc"
noop = "nop"

function execute_program(instructions_values)
    is_loop_detected = false

    infinite_loop_for_days = true
    index = 1
    accumulator = 0

    n_instructions = size(instructions_values, 1)
    has_executed = falses(n_instructions)
    while infinite_loop_for_days
        instruction, value = instructions_values[index]

        if (has_executed[index] == true)
            is_loop_detected = true
            break
        end

        has_executed[index] = true

        if (instruction == jump)
            index += parse(Int, value)
        elseif (instruction == accumulate)
            accumulator += parse(Int, value)
            index += 1
        else
            index += 1
        end

        if (index > n_instructions)
            is_loop_detected = false
            break
        end
    end
    
    return accumulator, is_loop_detected
end

function modify_instructions(instructions, instruction_positions, new_instruction)
    for (index, possibly_instruction) âˆˆ enumerate(instruction_positions)
        if (!possibly_instruction)
            continue
        end

        new_instructions_values = deepcopy(instructions)
        new_instructions_values[index][1] = new_instruction
        accumulator, is_loop_detected = execute_program(new_instructions_values)

        if (!is_loop_detected)
            return accumulator
        end
    end

    return nothing
end

function fix_infinite_loop(input, puzzle_part)
    instructions_values = split.(split(input, r"\n"), r"\s")

    instructions = [instruction for (instruction, _) in instructions_values]

    if (puzzle_part == 1)
        return execute_program(instructions_values)[1]
    else
        noops = instructions .== noop
        jumps = instructions .== jump
    
        accumulator = modify_instructions(instructions_values, noops, jump)
        if (accumulator !== nothing)
            return accumulator
        end
        
        return modify_instructions(instructions_values, jumps, noop)
    end
end

@show fix_infinite_loop(input, 1)